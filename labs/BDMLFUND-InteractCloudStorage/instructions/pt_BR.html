<h1>Como interagir com o Google Cloud Storage</h1>
<h2>Visão geral</h2>
<p>Neste laboratório, você aprenderá a provisionar uma máquina virtual, configurar a segurança dela e acessá-la remotamente.</p>
<h3>Conteúdo do laboratório</h3>
<p>Neste laboratório, você aprenderá a:</p>
<ul>
<li>
<p>criar uma instância do Compute Engine com o acesso e a segurança necessários;</p>
</li>
<li>
<p>usar o SSH para acessar a instância;</p>
</li>
<li>
<p>instalar o pacote de software Git para controle de versão de código-fonte;</p>
</li>
<li>
<p>fazer a ingestão de dados em uma instância do Compute Engine;</p>
</li>
<li>
<p>transformar os dados na instância do Compute Engine;</p>
</li>
<li>
<p>armazenar os dados transformados no Cloud Storage;</p>
</li>
<li>
<p>publicar dados do Cloud Storage na Web.</p>
</li>
</ul>
<h2>Introdução</h2>
<p>Neste laboratório, você aprenderá a provisionar uma máquina virtual, configurar o acesso à API e fazer login na VM remotamente.  Você raramente trabalhará com instâncias do Compute Engine em um nível tão baixo. No entanto, entender as noções básicas do GCP pode ser útil para resolver problemas.</p>
<p>Depois, você realizará manualmente as etapas de ingestão, transformação e publicação de dados de um canal:</p>
<ul>
<li>fazer a ingestão de dados em uma instância do Compute Engine;</li>
<li>transformar os dados na instância do Compute Engine;</li>
<li>armazenar os dados transformados no Cloud Storage;</li>
<li>publicar dados do Cloud Storage na Web.</li>
</ul>
<p>Você usará dados de terremotos em tempo real publicados pelo Serviço Geológico dos Estados Unidos (USGS, na sigla em inglês).</p>
<fragment path="/fragments/startqwiklab"></fragment>
<h2>Tarefa 1: crie uma instância do Compute Engine com o acesso necessário à API</h2>
<p>Para criar uma instância do Compute Engine, siga estas etapas:</p>
<ol>
<li>
<p>No Console do GCP, acesse o <strong>menu de navegação</strong> (<img alt="8ab244f9cffa6198.png" src="img/mainmenu.png">) e clique em <strong>Compute Engine</strong>.</p>
</li>
<li>
<p>Clique em <strong>Criar</strong> e aguarde o carregamento de um formulário. Será necessário alterar algumas opções no documento exibido.</p>
</li>
<li>
<p>Em <strong>Nome</strong>, deixe o valor padrão, em <strong>Região</strong>, selecione <strong>us-central1</strong> e em <strong>Zona</strong>, selecione <strong>us-central1-a</strong>.</p>
</li>
<li>
<p>Em <strong>Identidade e acesso à API</strong>, acesse <strong>Escopos de acesso</strong> e selecione <strong>Permitir acesso completo a todas as APIs do Cloud</strong>:</p>
<p><img src="img/8ab244f9cffa6198.png" alt="8ab244f9cffa6198.png"></p>
</li>
<li>
<p>Clique em <strong>Criar</strong>.</p>
</li>
</ol>
<h2>Tarefa 2: use o SSH para acessar a instância</h2>
<p>Após a criação da instância do Compute Engine, você poderá acessá-la remotamente com o Secure Shell (SSH):</p>
<ol>
<li>
<p>Quando a instância criada estiver disponível, clique em <strong>SSH</strong>:</p>
<p><img src="img/e4d9f3244db5ba38.png" alt="e4d9f3244db5ba38.png"></p>
<p><strong>Observação</strong>: as chaves SSH são transferidas de modo automático. Assim, você pode se conectar ao SSH diretamente do seu navegador, sem precisar de outro software.</p>
</li>
<li>
<p>Para ver as informações sobre a nova instância do Compute Engine, digite o seguinte no seu terminal SSH:</p>
<pre><code class="language-bash">cat /proc/cpuinfo
</code></pre>
</li>
</ol>
<h2>Tarefa 3: instale o software e faça a ingestão dos dados do USGS</h2>
<ol>
<li>
<p>No terminal SSH, digite o seguinte:</p>
<pre><code class="language-bash">sudo apt-get update
sudo apt-get -y -qq install git
</code></pre>
</li>
<li>
<p>Verifique se o git está instalado:</p>
<pre><code class="language-bash">git --version
</code></pre>
</li>
<li>
<p>Na linha de comando, digite:</p>
<pre><code class="language-bash">git clone https://github.com/GoogleCloudPlatform/training-data-analyst
</code></pre>
<p>Essa operação faz o download do código do GitHub.</p>
<p><strong>Observação</strong>: se aparecer um erro de autorização do git, é provável que haja um erro de digitação no URL.  Copie e cole o código acima.</p>
</li>
<li>
<p>Navegue até a pasta correspondente deste laboratório:</p>
<pre><code class="language-bash">cd training-data-analyst/CPB100/lab2b
</code></pre>
</li>
<li>
<p>Analise o código de ingestão usando o comando <strong>less</strong>:</p>
<pre><code class="language-bash">less ingest.sh
</code></pre>
<p>Com o comando <strong>less</strong>, você pode ver o arquivo. Pressione a <strong>barra de espaço</strong> para rolar para baixo, a letra <strong>b</strong> para voltar uma página ou a letra <strong>q</strong> para sair.</p>
<p>O programa <strong>ingest.sh</strong> faz o download de um conjunto de dados de terremotos do Serviço Geológico dos Estados Unidos referente aos sete dias anteriores.  Onde esse arquivo é salvo, no disco ou no Cloud Storage?</p>
</li>
<li>
<p>Execute o código de ingestão:</p>
<pre><code class="language-bash">bash ingest.sh
</code></pre>
</li>
<li>
<p>Veja que o download de alguns dados foi realizado:</p>
<pre><code class="language-bash">head earthquakes.csv
</code></pre>
<p>O comando <strong>head</strong> exibe as primeiras linhas do arquivo.</p>
</li>
</ol>
<h2>Tarefa 4: transforme os dados</h2>
<p>Você usará um programa em Python para transformar os dados brutos em um mapa de atividade sísmica:</p>
<p>Neste bloco de dados, fornecemos mais detalhes sobre o código de transformação:
<a href="https://github.com/GoogleCloudPlatform/datalab-samples/blob/master/basemap/earthquakes.ipynb">https://github.com/GoogleCloudPlatform/datalab-samples/blob/master/basemap/earthquakes.ipynb</a></p>
<p>Leia o conteúdo para entender a função do código de transformação.  O bloco de dados foi gravado no Datalab, um produto do GCP que você aprenderá a usar neste curso.</p>
<ol>
<li>
<p>Primeiro, instale os pacotes necessários do Python na instância do Compute Engine. No terminal SSH, digite o seguinte:</p>
<pre><code class="language-bash">bash install_missing.sh
</code></pre>
</li>
<li>
<p>Quando necessário, digite <strong>Y</strong> e pressione <strong>Enter</strong>.</p>
</li>
<li>
<p>Execute o código de transformação:</p>
<pre><code class="language-bash">python3 transform.py
</code></pre>
</li>
<li>
<p>Caso você liste o conteúdo do diretório, perceberá que há um novo arquivo de imagem:</p>
<pre><code class="language-bash">ls -l
</code></pre>
</li>
</ol>
<h2>Tarefa 5: crie um intervalo</h2>
<p>Crie um intervalo usando o console do GCP:</p>
<ol>
<li>
<p>No Console do GCP, no <strong>menu de navegação</strong> (<img alt="8ab244f9cffa6198.png" src="img/mainmenu.png">), clique em <strong>Storage</strong>.</p>
</li>
<li>
<p>Clique em <strong>Criar intervalo</strong>.</p>
</li>
<li>
<p>Em <strong>Nome</strong>, digite o <strong>código do projeto</strong> e clique em <strong>Criar</strong>. Para encontrar o <strong>código do projeto</strong>, clique nele no menu superior do Console do GCP e copie o valor que aparece no campo <strong>ID</strong> do projeto selecionado.</p>
<p>Anote o nome do seu intervalo e substitua <code>&lt;YOUR-BUCKET&gt;</code> por ele até o final deste laboratório.</p>
</li>
</ol>
<h2>Tarefa 6: armazene os dados</h2>
<p>Para armazenar os dados originais e transformados no Cloud Storage, siga estas etapas:</p>
<ol>
<li>
<p>No seu terminal SSH, digite o seguinte, substituindo <code>&lt;YOUR-BUCKET&gt;</code> pelo nome do intervalo que você criou na tarefa anterior:</p>
<pre><code class="language-bash">gsutil cp earthquakes.* gs://&lt;YOUR-BUCKET&gt;/earthquakes/
</code></pre>
</li>
<li>
<p>No Console do GCP, clique no nome do intervalo. Note que três novos arquivos aparecerão na pasta <strong>earthquakes</strong>. Clique em <strong>Atualizar</strong> caso eles não apareçam.</p>
</li>
</ol>
<h2>Tarefa 7: publique arquivos do Cloud Storage na Web</h2>
<p>Publique arquivos do Cloud Storage na Web com o seguinte comando:</p>
<pre><code class="language-bash">gsutil acl ch -u AllUsers:R gs://&lt;YOUR-BUCKET&gt;/earthquakes/*
</code></pre>
<p>Em <strong>earthquakes.htm</strong>, clique em <strong>Public link</strong>.</p>
<p><img src="img/public_access.png" alt="public_access.png"></p>
<p>Qual é o URL do arquivo do Cloud Storage publicado? Como ele está relacionado ao conteúdo e ao nome do seu intervalo?</p>
<p>Cite algumas das vantagens de publicar no Cloud Storage:</p>
<fragment path="/fragments/endqwiklab"></fragment>
<h5>Manual atualizado em 08 de Outubro de 2018</h5>
<h5>Laboratório testado em 08 de Outubro de 2018</h5>
<fragment path="/fragments/copyright"></fragment>
