name: 'Big Data & ML Fundamentals ILT Lab 2 v1.3 - Test'
description: "The script creates a datalab Instance.\n Download the notebook into Cloud Datalab."
deployment_manager_time: 660
run_regularly: true
failure_alerts_only: true
subscribers:
 - training-qa-testers@google.com
 - ajaych@google.com
steps:
 - command: |
    #part1, part2, part3
    gcloud -q services enable vision.googleapis.com translate.googleapis.com speech.googleapis.com language.googleapis.com compute.googleapis.com
    sudo apt-get install google-cloud-sdk-datalab
    # Create Datalab Instance
    datalab create bdmlvm --no-connect --no-create-repository --zone us-central1-a < <(yes y)
    gcloud compute config-ssh --quiet
    ssh bdmlvm.us-central1-a.$PROJECT -o StrictHostKeyChecking=no <<'EOF'
    while :
    do
    STATUS_CHECK=$(sudo docker ps --filter "name=datalab" --filter "status=running" --format '{{.Names}}')
    if [ "$STATUS_CHECK" == 'datalab' ]
    then
     break
    fi
    sleep 20s
    done
    # Download the notebook in the docker container
    docker container exec -i datalab sh -c "cd /content/datalab/ && git clone https://github.com/GoogleCloudPlatform/training-data-analyst"
    EOF
