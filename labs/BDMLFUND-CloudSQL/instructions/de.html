<h1>Mietobjektdaten in Cloud SQL einrichten</h1>
<h2>Übersicht</h2>
<p>In diesem Lab laden Sie Mietobjektdaten für das Mietobjekt-Empfehlungssystem in Cloud SQL.</p>
<h3><strong>Lerninhalte</strong></h3>
<p>In diesem Lab führen Sie die folgenden Aufgaben aus:</p>
<ul>
<li>
<p>Cloud SQL-Instanz erstellen</p>
</li>
<li>
<p>Datenbanktabellen anlegen und dazu SQL-Dateien aus Cloud Storage importieren</p>
</li>
<li>
<p>Tabellen mit Daten füllen und dazu CSV-Dateien aus Cloud Storage importieren</p>
</li>
<li>
<p>Zugriffsrechte auf Cloud SQL gewähren</p>
</li>
<li>
<p>Mietobjektdaten mit SQL-Anweisungen in CloudShell ansehen</p>
</li>
</ul>
<h2>Einführung</h2>
<p>In diesem Lab laden Sie Mietobjektdaten für das Mietobjekt-Empfehlungssystem in Cloud SQL. Das Empfehlungssystem selbst wird auf Dataproc mit Spark ML ausgeführt. Sie werden es im nächsten Lab einrichten.</p>
<fragment path="/fragments/startqwiklab"></fragment>
<h2>Einrichtung</h2>
<fragment path="/fragments/cloudshell"></fragment>
<h2>Aufgabe 1: Auf Lab-Code zugreifen</h2>
<p>So können Sie sich den Lab-Code in Cloud Shell ansehen:</p>
<ol>
<li>
<p>Geben Sie Folgendes in Cloud Shell ein:</p>
<pre><code class="language-bash">git clone https://github.com/GoogleCloudPlatform/training-data-analyst
</code></pre>
<p>Dadurch wird der Code aus GitHub heruntergeladen.</p>
</li>
<li>
<p>Öffnen Sie den Ordner zu diesem Lab:</p>
<pre><code class="language-bash">cd training-data-analyst/CPB100/lab3a
</code></pre>
</li>
<li>
<p>Sehen Sie sich die Datei zum Anlegen von Tabellen mit dem Befehl <strong>less</strong> an:</p>
<pre><code class="language-bash">less cloudsql/table_creation.sql
</code></pre>
<p>Mit dem Befehl <strong>less</strong> können Sie sich die Datei ansehen. Drücken Sie die <strong>Leertaste</strong>, um nach unten zu scrollen, die Taste <strong>b</strong>, um wieder nach oben zurückzukehren, oder die Taste <strong>q</strong>, um das Fenster zu schließen.</p>
</li>
<li>
<p>Geben Sie die folgenden Informationen ein (die erste Zeile wurde bereits ausgefüllt):</p>
<table>
<thead>
<tr>
<th align="left">Tabellenname</th>
<th align="left">Spalten</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Unterkunft</td>
<td align="left">ID, Bezeichnung, Ort, Preis, Zimmer, Bewertung, Typ</td>
</tr>
<tr>
<td align="left">________________?</td>
<td align="left">________________?</td>
</tr>
<tr>
<td align="left">________________?</td>
<td align="left">________________?</td>
</tr>
</tbody>
</table>
<p>In welcher Beziehung stehen diese Angaben zu den Mietobjektempfehlungen? Ergänzen Sie die folgenden Sätze:</p>
<ul>
<li>Wenn ein Nutzer ein Haus bewertet (und ihm z. B. vier Sterne gibt), wird ein Eintrag in die Tabelle _________________________ aufgenommen.</li>
<li>Allgemeine Informationen zu Häusern wie die Zimmerzahl und die Durchschnittsbewertung werden in der Tabelle ________________ gespeichert.</li>
<li>Die Funktion des Empfehlungssystems besteht darin, in der Tabelle __________________________ für jeden Nutzer und jedes Haus einen Eintrag zu erstellen. Daraus ergibt sich die prognostizierte Bewertung des Hauses durch diesen Nutzer.</li>
</ul>
</li>
<li>
<p>Sehen Sie sich die Datendateien mit dem Befehl <strong>head</strong> an:</p>
<pre><code class="language-bash">head cloudsql/*.csv
</code></pre>
<p>Mit dem Befehl <strong>head</strong> können Sie sich die ersten Zeilen jeder Datei anzeigen lassen.</p>
</li>
</ol>
<h2>Aufgabe 2: Bucket erstellen</h2>
<ol>
<li>
<p>Klicken Sie in der GCP Console auf das <strong>Navigationsmenü</strong> (<img alt="8ab244f9cffa6198.png" src="img/mainmenu.png">).</p>
</li>
<li>
<p>Klicken Sie auf <strong>Storage</strong>.</p>
</li>
<li>
<p>Klicken Sie auf <strong>Bucket erstellen</strong>.</p>
</li>
<li>
<p>Geben Sie als <strong>Name</strong> Ihre <strong>Projekt-ID</strong> ein. Wählen Sie unter <strong>Zugriffssteuerungsmodell</strong> die Option <strong>Berechtigungen auf Objekt- und Bucket-Ebene festlegen</strong> aus, und klicken Sie auf <strong>Erstellen</strong>. Die <strong>Projekt-ID</strong> finden Sie, indem Sie im Menü oben in der GCP Console auf das Projekt klicken. Kopieren Sie dann den Wert unter <strong>ID</strong> für das ausgewählte Projekt.</p>
<p>Notieren Sie sich den Namen des Buckets. Ersetzen Sie in diesem Lab <code>&lt;BUCKET-NAME&gt;</code> jeweils durch den Namen Ihres Buckets.</p>
</li>
</ol>
<h2>Aufgabe 3: SQL- und CSV-Dateien in Cloud Storage aufbereiten</h2>
<p>Bereiten Sie die Tabellendefinitions- und Datendateien in Cloud Storage auf, damit Sie sie später in Cloud SQL importieren können:</p>
<ol>
<li>
<p>Geben Sie in Cloud Shell im Verzeichnis <strong>lab3a</strong> Folgendes ein:</p>
<pre><code class="language-bash">gsutil cp cloudsql/* gs://&lt;BUCKET-NAME&gt;/sql/
</code></pre>
<p>Dabei ersetzen Sie &lt;BUCKET-NAME&gt; durch den Namen Ihres Buckets.</p>
</li>
<li>
<p>Klicken Sie in der GCP Console auf <strong>Storage</strong> und dann auf Ihren Bucket, um zu überprüfen, ob die SQL- und CSV-Dateien jetzt vorhanden sind.</p>
</li>
</ol>
<h2>Aufgabe 4: Cloud SQL-Instanz erstellen</h2>
<ol>
<li>
<p>Klicken Sie in der GCP Console unter "Storage" auf <strong>SQL</strong>.</p>
</li>
<li>
<p>Klicken Sie auf <strong>Instanz erstellen</strong>.</p>
</li>
<li>
<p><Strong>MySQL</Strong> auswählen. Klicken Sie auf <Strong>Weiter</Strong> falls erforderlich. Klicken Sie auf <Strong>MySQL-Entwicklung konfigurieren</Strong> oder <Strong>Zweite Generation auswählen</Strong>.</p>
</li>
<li>
<p>Geben Sie <strong>rentals</strong> als <strong>Instanz-ID</strong> ein.</p>
<p><img src="img/ab1cdf08212ecadf.png" alt="ab1cdf08212ecadf.png"></p>
</li>
<li>
<p>Scrollen Sie nach unten und geben Sie ein Root-Passwort an. Notieren Sie sich das root-Passwort, bevor Sie es vergessen</p>
</li>
<li>
<p>Klicken Sie auf <strong>Erstellen</strong>, um die Instanz zu erstellen. Die Bereitstellung Ihrer Cloud SQL-Instanz dauert etwa eine Minute.</p>
</li>
</ol>
<h2>Aufgabe 5: Tabellen anlegen</h2>
<ol>
<li>
<p>Klicken Sie in <strong>Cloud SQL</strong> auf <strong>rentals</strong>, um sich die Instanzinformationen anzusehen.</p>
</li>
<li>
<p>Klicken Sie in der Menüleiste oben auf <strong>Importieren</strong>.</p>
</li>
<li>
<p>Klicken Sie auf <strong>Durchsuchen</strong>. Ihnen wird eine Liste mit Buckets angezeigt. Klicken Sie auf den Bucket, den Sie erstellt haben, und gehen Sie zu <strong>sql</strong>. Klicken Sie dann auf <strong>table_creation.sql</strong>.</p>
</li>
<li>
<p>Klicken Sie auf <strong>Auswählen</strong> und dann auf <strong>Importieren</strong>.</p>
</li>
</ol>
    <aside class="warning"><p>
    <strong>Hinweis</strong>: Wenn der Import von <code>.sql</code> - oder <code>.csv</code> -Dateien beim ersten Versuch fehlschlägt, versuchen Sie es erneut.
    </p>
    </aside>
<h2>Aufgabe 6: Tabellen mit Daten füllen</h2>
<ol>
<li>
<p>Klicken Sie auf der GCP Console-Seite mit den Cloud SQL-Instanzdetails im Menü oben auf <strong>Importieren</strong>, um CSV-Dateien aus Cloud Storage zu importieren.</p>
</li>
<li>
<p>Klicken Sie auf <strong>Durchsuchen</strong>, um im von Ihnen erstellten Bucket <strong>sql</strong> zu finden, und klicken Sie dann auf <strong>accommodation.csv</strong>. Klicken Sie auf <strong>Auswählen</strong>.</p>
</li>
<li>
<p>Wählen Sie als <strong>Datenbank</strong> die Option <strong>recommendation_spark</strong> aus.</p>
</li>
<li>
<p>Geben Sie für <strong>Tabelle</strong> die Bezeichnung <strong>Accommodation</strong> ein.</p>
<p><img src="img/c899adb7fdb39f17.png" alt="c899adb7fdb39f17.png"></p>
</li>
<li>
<p>Klicken Sie auf <strong>Importieren</strong>.</p>
</li>
<li>
<p>Wiederholen Sie die Schritte zum <strong>Importieren</strong> (1–5) für <strong>rating.csv</strong>. Geben Sie hierbei für <strong>Tabelle</strong> die Bezeichnung <strong>Rating</strong> ein.</p>
</li>
</ol>
<h2>Aufgabe 7: Daten in Cloud SQL ansehen</h2>
<ol>
<li>
<p>Mit der mysql-CLI können Sie sich Daten in Cloud SQL genauer ansehen. Geben Sie dazu in Cloud Shell Folgendes ein:</p>
<pre><code class="language-bash">wget https://dl.google.com/cloudsql/cloud_sql_proxy.linux.amd64 -O cloud_sql_proxy
chmod +x cloud_sql_proxy
</code></pre>
</li>
<li>
<p>Suchen Sie in der GCP Console den Namen der SQL-Instanzverbindung auf der Registerkarte Übersicht und kopieren Sie sie. Ersetzen Sie im folgenden Befehl <INSTANCE_CONNECTION_NAME> durch diesen Wert und führen Sie ihn aus.</p>
<pre><code class="language-bash">./cloud_sql_proxy -instances=&lt;INSTANCE_CONNECTION_NAME&gt;=tcp:3306 &
</code></pre>
</li>
<li>
<p>Verbinden Sie sich mit mysql mit der Cloud-SQL-Instanz:</p>
<pre><code class="language-bash">mysql -u root -p --host 127.0.0.1
</code></pre>
</li>
<li>
<p>In MySQL werden Sie aufgefordert, das Root-Passwort einzugeben. Geben Sie das Passwort ein, wenn Sie dazu aufgefordert werden.</p>
</li>
<li>
<p>Geben Sie in Cloud Shell Folgendes in die mysql-Eingabeaufforderung ein:</p>
<pre><code class="language-bash">use recommendation_spark;
</code></pre>
<p>Damit wird die Datenbank in der mysql-Sitzung festgelegt.</p>
</li>
<li>
<p>Sehen Sie sich die Liste der von Ihnen erstellten Tabellen genau an. So können Sie Tippfehler in Ihrer Abfrage in Schritt 4 vermeiden.</p>
<pre><code class="language-bash">show tables;
</code></pre>
</li>
<li>
<p>Überprüfen Sie mit dem folgenden Befehl, ob die Daten geladen wurden:</p>
<pre><code>select * from Rating;
</code></pre>
<p>Beispielausgabe:</p>
<pre><code>| 23     | 99     |      5 |
| 4      | 99     |      4 |
| 7      | 99     |      5 |
| 8      | 99     |      5 |
+--------+--------+--------+
1186 rows in set (0.03 sec)
</code></pre>
</li>
<li>
<p>Mal sehen, ob es ein tolles Angebot gibt:</p>
<pre><code>select * from Accommodation where type = 'castle' and price &lt; 1500;
</code></pre>
<p>Alle günstigen Schlösser wurden schlecht bewertet.</p>
</li>
<li>
<p>Sie können die mysql-Eingabeaufforderung verlassen, indem Sie <strong>exit</strong> eingeben.</p>
</li>
</ol>
<fragment path="/fragments/endqwiklab"></fragment>
<h5>Handbuch zuletzt aktualisiert am 22. Februar 2019</h5>
<h5>Lab zuletzt getestet am 22. Februar 2019</h5>
<fragment path="/fragments/copyright"></fragment>
